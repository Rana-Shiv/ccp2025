<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Turmas</title>
  <style>
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    input[type="text"] { width: 90%; }
    button { padding: 5px 10px; }

    /* Toast styles */
    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    .toast {
      padding: 12px 20px;
      margin-bottom: 10px;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      opacity: 0.95;
      animation: slideIn 0.3s ease forwards;
    }

    .toast.success { background-color: #4CAF50; }
    .toast.error { background-color: #F44336; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 0.95; }
    }
  </style>
</head>
<body>
  <h2>Gerenciar Turmas</h2>
  <table id="turmasTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Descrição</th>
        <th>Status</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Nova Turma</h3>
  <input type="text" id="novaDescricao" placeholder="Descrição">
  <label>
    <input type="checkbox" id="novaStatus" checked> Ativo
  </label>
  <button onclick="criarTurma()">Criar</button>

  <!-- Toast container -->
  <div id="toast-container"></div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/SEU_SCRIPT_ID/exec';

    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerText = message;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function carregarTurmas() {
      fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#turmasTable tbody');
          tbody.innerHTML = '';
          for (let i = 1; i < data.length; i++) {
            const [id, descricao, status] = data[i];
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${id}</td>
              <td><input type="text" value="${descricao}" onchange="atualizar(${id}, this.value, null)"></td>
              <td><input type="checkbox" ${status === true ? 'checked' : ''} onchange="atualizar(${id}, null, this.checked)"></td>
              <td><button onclick="atualizar(${id}, document.querySelectorAll('tr')[${i}].children[1].children[0].value, document.querySelectorAll('tr')[${i}].children[2].children[0].checked)">Salvar</button></td>
            `;
            tbody.appendChild(row);
          }
        })
        .catch(error => {
          console.error('Erro ao carregar turmas:', error);
          showToast("Erro ao carregar turmas!", "error");
        });
    }

    function atualizar(id, descricao, status) {
      const params = new URLSearchParams({
        action: 'update',
        id,
        description: descricao ?? '',
        status: status ?? false
      });

      fetch(scriptURL, { method: 'POST', body: params })
        .then(res => res.text())
        .then(() => {
          showToast("Turma atualizada com sucesso!", "success");
          carregarTurmas();
        })
        .catch(error => {
          console.error('Erro ao atualizar turma:', error);
          showToast("Erro ao atualizar turma!", "error");
        });
    }

    function criarTurma() {
      const descricao = document.getElementById('novaDescricao').value;
      const status = document.getElementById('novaStatus').checked;

      if (!descricao) {
        showToast("Descrição é obrigatória!", "error");
        return;
      }

      const params = new URLSearchParams({
        action: 'create',
        description: descricao,
        status
      });

      fetch(scriptURL, { method: 'POST', body: params })
        .then(res => res.text())
        .then(() => {
          showToast("Turma criada com sucesso!", "success");
          document.getElementById('novaDescricao').value = '';
          document.getElementById('novaStatus').checked = true;
          carregarTurmas();
        })
        .catch(error => {
          console.error('Erro ao criar turma:', error);
          showToast("Erro ao criar turma!", "error");
        });
    }

    window.onload = carregarTurmas;
  </script>
</body>
</html>
